<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BreatheEarth</title>
<style>
  body{
    margin:0; height:100%; display:grid; place-items:center;
    font-family:system-ui,Inter,Arial,sans-serif;
    background:#e8fdea; color:#0f2518; transition:background .3s ease,color .3s ease;
  }
  .card{
    text-align:center; background:rgba(255,255,255,.75);
    padding:28px 24px; border-radius:18px; max-width:600px;
  }
  h1{margin:.2rem 0;font-size:2rem}
  .sub{opacity:.8;margin-bottom:1rem}
  .status{font-size:2rem;font-weight:900;margin:.5rem 0}
  .err{color:#b00;font-weight:700;margin-top:.5rem}
  button{margin-top:1rem;padding:10px 16px;border:0;border-radius:12px;font-weight:700;
    background:#0f2518;color:#fff;cursor:pointer}
</style>
</head>
<body>
<div class="card">
  <h1>BreatheEarth</h1>
  <p class="sub">The air you breathe connects us all.</p>
  <div id="place">Requesting location…</div>
  <div class="status" id="status">—</div>
  <div id="pm">PM2.5: — µg/m³</div>
  <div id="time">—</div>
  <div class="err" id="err"></div>
  <button id="retry" style="display:none">Try again</button>
</div>

<script>
const airURL = (lat,lon)=>`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`;
const revURL = (lat,lon)=>`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&count=1&language=en`;

const el={p:place,status,pm,time,err,retry};
function setTheme(word){
  if(word==="GOOD"){document.body.style.background="#91e2a0";document.body.style.color="#0a2617";}
  else if(word==="BAD"){document.body.style.background="#ffe56e";document.body.style.color="#2a2107";}
  else{document.body.style.background="#ff9d4a";document.body.style.color="#3a1b00";}
}
function category(pm){return pm<=15?"GOOD":pm<=35?"BAD":"WORSE";}
function t(iso){return new Date(iso).toLocaleString([], {hour:'2-digit',minute:'2-digit',month:'short',day:'2-digit'});}
async function j(url){const r=await fetch(url);if(!r.ok)throw new Error(r.status);return r.json();}

async function load(lat,lon){
  el.err.textContent="";el.status.textContent="Loading…";
  try{
    const rev=await j(revURL(lat,lon));const name=rev.results?.[0];
    el.p.textContent=name?[name.name,name.country].filter(Boolean).join(', '):"Your location";
    const air=await j(airURL(lat,lon));
    const v=air.hourly.pm2_5.at(-1);const time=air.hourly.time.at(-1);
    const label=category(v);
    el.status.textContent=`Air quality is ${label}`;
    el.pm.textContent=`PM2.5: ${v.toFixed(1)} µg/m³`;
    el.time.textContent=`Updated ${t(time)}`;
    setTheme(label);
  }catch(e){
    el.err.textContent="Could not load air data. Check network or try again.";
    el.status.textContent="—";
  }
}
function ask(){
  el.retry.style.display="none";el.err.textContent="";el.p.textContent="Requesting location…";
  if(!navigator.geolocation){el.err.textContent="No geolocation support.";return;}
  navigator.geolocation.getCurrentPosition(
    pos=>load(pos.coords.latitude,pos.coords.longitude),
    ()=>{el.err.textContent="Location blocked. Please allow and reload.";el.retry.style.display="inline-block";}
  );
}
el.retry.onclick=ask;
ask();
</script>
</body>
</html>
